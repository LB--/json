cmake_minimum_required(VERSION 3.4)

project(LB::json-superproject
	LANGUAGES NONE
)

set(CTEST_ARGS "--output-on-failure" CACHE STRING ";-list of arguments to pass to ctest")

include(ExternalProject)
ExternalProject_Add(utf
	SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/utf"
	BUILD_ALWAYS 1
	LIST_SEPARATOR "#"
	CMAKE_ARGS
		"-DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}"
		"-DBUILD_TESTS=OFF"
		"-DBUILD_EXAMPLES=OFF"
		${LB_UTF_ARGS}
	TEST_EXCLUDE_FROM_MAIN 1
)
ExternalProject_Add(json
	DEPENDS
		utf
	SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/json"
	BUILD_ALWAYS 1
	LIST_SEPARATOR "#"
	CMAKE_ARGS
		"-DCMAKE_INSTALL_PREFIX=${CMAKE_INSTALL_PREFIX}"
		"-DCMAKE_MODULE_PATH=${CMAKE_CURRENT_SOURCE_DIR}/utf/cmake"
		${LB_JSON_ARGS}
	TEST_BEFORE_INSTALL 1
	TEST_COMMAND ctest ${CTEST_ARGS}
)
